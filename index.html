<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Avrora Qrup IV Futbol √áempionatƒ± </title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      /* overflow: scroll;
      scrollbar-width: none; 
     -ms-overflow-style: none;   */
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 2600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .header {
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
      animation: float 20s linear infinite;
    }

    @keyframes float {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }

      100% {
        transform: translate(-50px, -50px) rotate(360deg);
      }
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      align-items: start;
      padding: 30px;
    }

    .pots-section {
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .pots-section h3 {
      font-size: 1.5rem;
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
    }

    .pots {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .pot-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border: 2px solid transparent;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .pot-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .pot-card:hover::before {
      transform: scaleX(1);
    }

    .pot-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
      border-color: #4ecdc4;
    }

    .pot-card h4 {
      font-size: 1.2rem;
      color: #2c3e50;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
    }

    .team-btn {
      display: block;
      width: 100%;
      text-align: center;
      margin: 8px 0;
      padding: 12px 16px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #f8f9fa);
      cursor: pointer;
      font-weight: 500;
      color: #495057;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .team-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(78, 205, 196, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.3s ease, height 0.3s ease;
    }

    .team-btn:hover::before {
      width: 100%;
      height: 100%;
    }

    .team-btn:hover {
      border-color: #4ecdc4;
      color: #2c3e50;
      transform: scale(1.02);
      box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
    }

    .team-btn:active {
      transform: scale(0.98);
    }

    .team-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .results-section {
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - 180px);
      overflow: hidden;
    }

    .results-section h3 {
      font-size: 1.5rem;
      color: #2c3e50;
      margin-bottom: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pill {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      color: white;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    .lines {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: white;
      padding: 0;
      border-radius: 10px;
      border: 1px solid #e9ecef;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .fixture-item {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      border-bottom: 1px solid #f1f3f4;
      transition: all 0.2s ease;
      animation: slideIn 0.5s ease forwards;
      opacity: 0;
      transform: translateX(-20px);
    }

    .fixture-item:last-child {
      border-bottom: none;
    }

    .fixture-item:hover {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      transform: translateX(5px);
    }

    .fixture-item .team-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 1;
    }

    .fixture-item .team-badge {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 0.9rem;
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
    }

    .fixture-item .team-name {
      font-weight: 600;
      color: #2c3e50;
      font-size: 1.1rem;
    }

    .fixture-item .vs-symbol {
      color: #6c757d;
      font-weight: 700;
      font-size: 1.2rem;
      margin: 0 20px;
    }

    .fixture-item .opponent-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .fixture-item .opponent-badge {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 0.9rem;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .fixture-item .opponent-name {
      font-weight: 600;
      color: #2c3e50;
      font-size: 1.1rem;
    }

    .global-fixtures {
      background: white;
      padding: 0;
      border-radius: 10px;
      border: 1px solid #e9ecef;
      flex: 1 1 auto;
      min-height: 0; /* allow flex child to shrink for scrolling */
      overflow-y: auto;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .team-fixture-card {
      margin: 0;
      border-bottom: 2px solid #f1f3f4;
      transition: all 0.3s ease;
      animation: slideIn 0.5s ease forwards;
      opacity: 0;
      transform: translateX(-20px);
    }

    .team-fixture-card:last-child {
      border-bottom: none;
    }

    .team-fixture-card:hover {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      transform: translateX(5px);
    }

    .team-fixture-header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      border-radius: 10px 10px 0 0;
    }

    .team-fixture-header .team-badge {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .team-fixture-header .team-name {
      font-weight: 700;
      font-size: 1.3rem;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .team-fixture-header .opponent-count {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.2);
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .team-fixture-opponents {
      padding: 20px;
      display: grid;
      /* grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); */
      grid-template-columns: repeat(3, minmax(200px, 1fr));
      gap: 15px;
    }

    .team-badge {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      /* keeps logos circular */
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      /* optional, makes logos pop */
      border: 2px solid rgba(0, 0, 0, 0.1);
    }

    .team-badge img.team-logo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* crop logos nicely */
    }

    .opponent-badge {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      /* keeps logos circular */
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      /* optional, makes logos pop */
      border: 2px solid rgba(0, 0, 0, 0.1);
    }

    .opponent-badge img.team-logo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      /* crop logos nicely */
    }


    .opponent-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: linear-gradient(135deg, #ffffff, #f8f9fa);
      border-radius: 8px;
      border: 1px solid #e9ecef;
      transition: all 0.2s ease;
    }

    .opponent-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-color: #4ecdc4;
    }

    .opponent-item .opponent-badge {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 0.8rem;
      box-shadow: 0 3px 10px rgba(255, 107, 107, 0.3);
    }

    .opponent-item .opponent-name {
      font-weight: 600;
      color: #2c3e50;
      font-size: 1rem;
    }

    .opponent-item .pot-indicator {
      margin-left: auto;
      background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* Animation delays for fixture items */
    .fixture-item:nth-child(1) {
      animation-delay: 0.1s;
    }

    .fixture-item:nth-child(2) {
      animation-delay: 0.2s;
    }

    .fixture-item:nth-child(3) {
      animation-delay: 0.3s;
    }

    .fixture-item:nth-child(4) {
      animation-delay: 0.4s;
    }

    .fixture-item:nth-child(5) {
      animation-delay: 0.5s;
    }

    .fixture-item:nth-child(6) {
      animation-delay: 0.6s;
    }

    .team-fixture-card:nth-child(1) {
      animation-delay: 0.1s;
    }

    .team-fixture-card:nth-child(2) {
      animation-delay: 0.2s;
    }

    .team-fixture-card:nth-child(3) {
      animation-delay: 0.3s;
    }

    .team-fixture-card:nth-child(4) {
      animation-delay: 0.4s;
    }

    .team-fixture-card:nth-child(5) {
      animation-delay: 0.5s;
    }

    hr {
      margin: 25px 0;
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #4ecdc4, transparent);
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #4ecdc4, #45b7d1);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #45b7d1, #4ecdc4);
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4ecdc4;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Success Animation */
    .success-animation {
      animation: successPulse 0.6s ease;
    }

    @keyframes successPulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .pots {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 20px;
      }

      .pots {
        grid-template-columns: 1fr;
      }

      .header h1 {
        font-size: 2rem;
      }

      .header p {
        font-size: 1rem;
      }

      .team-fixture-opponents {
        grid-template-columns: 1fr;
      }
    }

    @keyframes slideIn {
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Popup redesign */
    .popup-header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 16px 18px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }
    .popup-header .team-badge {
      width: 46px; height: 46px; border-radius: 50%;
      overflow: hidden; background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.35);
      display:flex; align-items:center; justify-content:center;
    }
    .popup-header .team-name {
      font-size: 20px; font-weight: 700; color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    .popup-header .opponent-count {
      margin-left: auto; background: rgba(255,255,255,0.2);
      padding: 6px 12px; border-radius: 999px; font-weight: 700;
      border: 1px solid rgba(255,255,255,0.35);
    }
    .popup-opponents {
      display: grid; grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
    }
    .popup-card {
      display: flex; align-items: center; gap: 12px;
      padding: 14px 16px; border-radius: 12px;
      background: linear-gradient(145deg, #ffffff, #f6f7fb);
      border: 1px solid #e6e8ef;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .popup-card:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.08); border-color: #4ecdc4; }
    .popup-card .team-badge { width: 42px; height: 42px; border-radius: 50%; overflow: hidden; border: 2px solid rgba(0,0,0,0.06); background: #fff; display:flex; align-items:center; justify-content:center; }
    .popup-card .name { font-weight: 700; color: #2c3e50; }
    .popup-card .pill { margin-left: auto; background: #eafaf7; color: #0b8f7a; padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid #b8efe6; box-shadow: none; animation: none; }
    
    /* Football-themed draw overlay */
    .draw-overlay {
      position: fixed;
      inset: 0;
      z-index: 1200;
      display: none;
      align-items: center;
      justify-content: center;
      background: radial-gradient(1200px 600px at 50% -10%, rgba(255,255,255,0.05), rgba(0,0,0,0.9)),
                  radial-gradient(800px 400px at 0% 0%, rgba(46, 204, 113, 0.15), transparent 60%),
                  radial-gradient(800px 400px at 100% 0%, rgba(46, 204, 113, 0.15), transparent 60%),
                  #000;
      color: #fff;
    }
    .draw-stage {
      position: relative;
      width: min(900px, 92vw);
      height: min(520px, 60vh);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6), inset 0 0 120px rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      background:
        repeating-linear-gradient(90deg, rgba(255,255,255,0.05) 0 2px, transparent 2px 80px),
        linear-gradient(180deg, #136f27, #0f5a20);
    }
    .pitch-lines { position: absolute; inset: 0; pointer-events: none; }
    .pitch-lines::before, .pitch-lines::after { content: ''; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); border: 2px solid rgba(255,255,255,0.6); border-radius: 50%; }
    .pitch-lines::before { width: 160px; height: 160px; }
    .pitch-lines::after { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,0.85); border: none; }
    .half-line { position: absolute; top: 0; bottom: 0; left: 50%; width: 2px; background: rgba(255,255,255,0.6); transform: translateX(-50%); }
    .pen-area { position: absolute; width: 140px; height: 50%; top: 25%; border: 2px solid rgba(255,255,255,0.6); }
    .pen-left { left: 14px; border-right: none; border-radius: 12px 0 0 12px; }
    .pen-right { right: 14px; border-left: none; border-radius: 0 12px 12px 0; }
    .stadium-light { position: absolute; width: 220px; height: 220px; border-radius: 50%; filter: blur(24px); opacity: 0.35; mix-blend-mode: screen; animation: lightPulse 2.8s ease-in-out infinite; }
    .light-1 { left: -60px; top: -60px; background: #74ff9e; }
    .light-2 { right: -60px; top: -60px; background: #74ff9e; animation-delay: .6s; }
    .light-3 { left: -60px; bottom: -60px; background: #66d9ff; animation-delay: 1.2s; }
    .light-4 { right: -60px; bottom: -60px; background: #66d9ff; animation-delay: 1.8s; }
    @keyframes lightPulse { 0%,100%{opacity:.25; transform: scale(1);} 50%{opacity:.5; transform: scale(1.08);} }
    .ball { position: absolute; width: 54px; height: 54px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #ffffff 0 24px, transparent 25px), radial-gradient(circle at 70% 70%, #ffffff 0 24px, transparent 25px), radial-gradient(circle at 50% 50%, #111 0 8px, #fff 9px 24px, transparent 25px); box-shadow: 0 6px 16px rgba(0,0,0,0.45); animation: ballPath 1.2s cubic-bezier(.22,.61,.36,1) infinite, spin 1.2s linear infinite; }
    @keyframes ballPath { 0% { left: 8%; top: 78%; } 25% { left: 25%; top: 62%; } 50% { left: 50%; top: 48%; } 75% { left: 75%; top: 62%; } 100% { left: 92%; top: 78%; } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .draw-title { position: absolute; left: 50%; top: 14px; transform: translateX(-50%); background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.18); color: #eafff5; padding: 8px 14px; border-radius: 999px; font-weight: 800; letter-spacing: .3px; text-shadow: 0 1px 2px rgba(0,0,0,.6); box-shadow: 0 6px 16px rgba(0,0,0,.25), inset 0 0 18px rgba(255,255,255,.06); font-size: 14px; }
    .draw-sub { position: absolute; bottom: 14px; left: 50%; transform: translateX(-50%); color: #fff; font-weight: 700; font-size: 18px; opacity: .9; background: rgba(0,0,0,.35); padding: 6px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); }
    .confetti-canvas { position: absolute; inset: 0; pointer-events: none; }

    /* Live draw slots */
    .draw-slots { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 14px; width: min(720px, 90%); }
    .slot { background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; height: 110px; display:flex; align-items:center; justify-content:center; box-shadow: inset 0 0 24px rgba(255,255,255,0.05); position: relative; }
    .slot img { width: 72px; height: 72px; border-radius: 50%; object-fit: cover; background: #fff; border: 2px solid rgba(255,255,255,0.3); }
    .slot .label { position:absolute; bottom:6px; left:50%; transform:translateX(-50%); background: rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.15); color:#eafff5; padding:2px 8px; border-radius:8px; font-size:11px; font-weight:700; }
    .slot.revealed { animation: successPulse 0.6s ease; border-color: rgba(76,205,196,0.8); }

    /* Smooth popup entrance */
    .popup-animate-in { animation: popupIn .32s cubic-bezier(.22,.61,.36,1) both; }
    @keyframes popupIn { from { opacity: 0; transform: translateY(12px) scale(0.985); } to { opacity: 1; transform: translateY(0) scale(1); } }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>‚öΩ Avrora Qrup IV Futbol √áempionatƒ± </h1>
      <!-- <p>Click on any team to draw them and automatically assign 6 opponents from different pots. Each team gets exactly one opponent from each pot.</p> -->
    </div>

    <div class="layout">
      <div class="pots-section">
        <h3>‚öΩ S…ôb…ôtl…ôr</h3>
        <div id="potsContainer" class="pots"></div>
      </div>

      <div class="results-section">
        <h3 id="selectedTeamHeader">üìã Se√ßilmi≈ü komandanƒ±n r…ôqibl…ôri <span class="pill" id="selectedTeamPill"></span></h3>
        <div id="selectedTeamOutput" class="lines"></div>

        <hr id="selectedTeamDivider">

        <h3>üåç S…ôb…ôtl…ôr √ºzr…ô r…ôqibl…ôr</h3>
        <div id="globalFixtures" class="global-fixtures"></div>
      </div>
    </div>
  </div>

  <script>
    const manualTeamNames = [
      // S…ôb…ôt 1
      ["Logistika", "Elit ƒ∞√ßkil…ôr", "Tamstore Satƒ±≈ü", "Maliyy…ô 1", "T…ôhl√ºk…ôsizlik", "Bizon Enerji"],
      // S…ôb…ôt 2
      ["ƒ∞stehsalat", "Tamstore Ofis", "Old City Ganja", "Xƒ±rdalan", "SPL", "N…ôqliyyat 2"],
      // S…ôb…ôt 3
      ["Keyfiyy…ôt", "Dev Ops", "Marketinq", "ƒ∞dxal v…ô Ticari mallar", "Satƒ±≈üa N…ôzar…ôt", "Maliyy…ô 2"],
      // S…ôb…ôt 4
      ["T…ômir-Tikinti", "Piv…ô anbarƒ±", "Alcopoint", "M…ôrk…ôzi Satƒ±≈ü Anbarƒ±", "S√ºd Team", "Satƒ±≈üƒ±n ƒ∞nki≈üafƒ±"],
      // S…ôb…ôt 5
      ["OVEN", "Fabrist", "ƒ∞dxal Region", "Tamstore Daxili N…ôzar…ôt", "Tamstore Tornado", "Zforce"],
      // S…ôb…ôt 6
      ["L…ônk…ôran", "G√∂y√ßay", "Qarabaƒü B…ôrd…ô", "Saatlƒ±", "≈ûahdaƒü Quba", "≈û…ôki"]
    ];


    const pots = [];
    const originalPots = [];
    const teamToPot = new Map();
    let teamCounter = 1;

    // initialize 6 pots with 6 teams each
    for (let p = 0; p < manualTeamNames.length; p++) {
      const pot = manualTeamNames[p];
      pots.push([...pot]); // for dynamic drawing
      originalPots.push([...pot]); // for reference
      for (let team of pot) {
        teamToPot.set(team, p);
      }
    }

    // fixtures: team -> Set of opponents
    const fixtures = new Map();
    // selectedTeams: Set of teams that have been explicitly selected by user
    const selectedTeams = new Set();

    // --- Persistence helpers (localStorage) ---
    const STORAGE_KEY = 'avrora-draw-state-v1';

    function serializeState() {
      const fixturesObj = {};
      fixtures.forEach((set, team) => {
        fixturesObj[team] = Array.from(set);
      });
      return {
        fixtures: fixturesObj,
        selectedTeams: Array.from(selectedTeams),
      };
    }

    function saveState() {
      try {
        const data = serializeState();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.warn('Failed to save state', e);
      }
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return false;
        const data = JSON.parse(raw);
        if (data && data.fixtures) {
          Object.keys(data.fixtures).forEach(team => {
            fixtures.set(team, new Set(data.fixtures[team] || []));
          });
        }
        if (Array.isArray(data?.selectedTeams)) {
          data.selectedTeams.forEach(t => selectedTeams.add(t));
        }

        // rebuild remaining pots by excluding already selected teams
        for (let p = 0; p < pots.length; p++) {
          const remaining = originalPots[p].filter(t => !selectedTeams.has(t));
          pots[p] = [...remaining];
        }
        return true;
      } catch (e) {
        console.warn('Failed to load state', e);
        return false;
      }
    }

    function ensureTeam(t) { if (!fixtures.has(t)) fixtures.set(t, new Set()); }

    // Returns true if the given team already has at least one opponent
    // whose pot index equals potIndexToCheck
    function teamHasOpponentFromPot(teamName, potIndexToCheck) {
      if (!fixtures.has(teamName)) return false;
      for (const opponent of fixtures.get(teamName)) {
        if (teamToPot.get(opponent) === potIndexToCheck) {
          return true;
        }
      }
      return false;
    }

    // symmetric fixture
    function addFixture(a, b, potA, potB) {
      ensureTeam(a); ensureTeam(b);
      fixtures.get(a).add(b);
      fixtures.get(b).add(a);
    }

    const potsContainer = document.getElementById('potsContainer');
    const selectedTeamOutput = document.getElementById('selectedTeamOutput');
    const selectedTeamPill = document.getElementById('selectedTeamPill');
    const globalFixturesDiv = document.getElementById('globalFixtures');
    // Hide inline section; we'll show selected team in a popup
    const selectedTeamHeader = document.getElementById('selectedTeamHeader');
    const selectedTeamDivider = document.getElementById('selectedTeamDivider');
    if (selectedTeamHeader) selectedTeamHeader.style.display = 'none';
    if (selectedTeamDivider) selectedTeamDivider.style.display = 'none';
    if (selectedTeamOutput) selectedTeamOutput.style.display = 'none';

    function renderPots() {
      potsContainer.innerHTML = '';
      for (let p = 0; p < pots.length; p++) {
        const card = document.createElement('div');
        card.className = 'pot-card';
        card.innerHTML = `<h4>S…ôb…ôt ${p + 1}</h4>`;

        pots[p].forEach(team => {
          const btn = document.createElement('button');
          btn.className = 'team-btn';
          btn.textContent = team;
          btn.onclick = () => selectTeam(team);
          card.appendChild(btn);
        });
        potsContainer.appendChild(card);
      }
    }

    function randomPick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function renderGlobalFixtures() {
      const lines = [];

      // Show only explicitly selected teams; latest selection on top
      const teamsToShow = Array.from(selectedTeams).slice().reverse();

      teamsToShow.forEach(team => {
        const opponents = Array.from(fixtures.get(team)).sort((a,b)=>{
          const pa = teamToPot.get(a) ?? 0;
          const pb = teamToPot.get(b) ?? 0;
          if (pa !== pb) return pa - pb; // order by pot
          return a.localeCompare(b); // tie-breaker: name
        });
        const opponentList = opponents.join(', ');
        console.log("fixtures",fixtures)
        // Create team fixture card
        const teamCard = document.createElement('div');
        teamCard.className = 'team-fixture-card';

        // Create header with team info
        const header = document.createElement('div');
        header.className = 'team-fixture-header';

        const teamBadge = document.createElement('div');
        teamBadge.className = 'team-badge';
        // teamBadge.textContent = team.split(' ')[1]; // Extract team number

        const logo = document.createElement("img")
        logo.src = `yeni-logolar/${team}.png`;
        logo.alt = team;
        logo.className = 'team-logo'

        teamBadge.appendChild(logo)

        const teamName = document.createElement('div');
        teamName.className = 'team-name';
        teamName.textContent = team;

        const opponentCount = document.createElement('div');
        opponentCount.className = 'opponent-count';
        opponentCount.textContent = `${opponents.length} r…ôqib`;

        header.appendChild(teamBadge);
        header.appendChild(teamName);
        header.appendChild(opponentCount);

        // Create opponents grid
        const opponentsGrid = document.createElement('div');
        opponentsGrid.className = 'team-fixture-opponents';

        function createTeamLogo(team) {
          const badge = document.createElement("div");
          badge.className = "team-badge";

          const img = document.createElement("img");
          img.src = `yeni-logolar/${team}.png`;
          img.alt = team;
          img.className = "team-logo";

          badge.appendChild(img);
          return badge;
        }



        opponents.forEach(opponent => {
          const opponentItem = document.createElement('div');
          opponentItem.className = 'opponent-item';

          // const opponentBadge = document.createElement('div');
          // opponentBadge.className = 'opponent-badge';
          // opponentBadge.textContent = opponent.split(' ')[1]; // Extract team number
          // ‚úÖ use createTeamLogo instead of empty badge div
          const opponentBadge = createTeamLogo(opponent);



          const opponentName = document.createElement('div');
          opponentName.className = 'opponent-name';
          opponentName.textContent = opponent;

          const potIndicator = document.createElement('div');
          potIndicator.className = 'pot-indicator';
          potIndicator.textContent = `S…ôb…ôt ${teamToPot.get(opponent) + 1}`;

          opponentItem.appendChild(opponentBadge);
          opponentItem.appendChild(opponentName);
          opponentItem.appendChild(potIndicator);

          opponentsGrid.appendChild(opponentItem);
        });

        teamCard.appendChild(header);
        teamCard.appendChild(opponentsGrid);
        lines.push(teamCard);
      });

      globalFixturesDiv.innerHTML = '';
      lines.forEach(line => globalFixturesDiv.appendChild(line));
      console.log("final result", lines)
    }

    function selectTeam(team) {
      const pot = teamToPot.get(team);
      if (pot === undefined) return;

      // Add loading animation
      const teamBtn = event.target;
      teamBtn.innerHTML = '<span class="loading"></span>';
      teamBtn.disabled = true;

      // Show football-themed loading overlay
      if (typeof showDrawOverlay === 'function') {
        showDrawOverlay(team);
      }

      // Simulate processing time for better UX
      setTimeout(() => {
        // remove only the physically drawn team
        const idx = pots[pot].indexOf(team);
        if (idx !== -1) pots[pot].splice(idx, 1);
        renderPots();

        // Mark this team as selected
        selectedTeams.add(team);

        ensureTeam(team);
        const lines = [];

        // Always ensure the team gets 6 opponents (one from each pot)
        for (let p = 0; p < 6; p++) {
          // check if team already has an opponent from this pot
          const existingOpp = Array.from(fixtures.get(team)).find(x => teamToPot.get(x) === p);
          if (existingOpp) {
            lines.push(`${team} - ${existingOpp}`);
            continue;
          }

          // pick candidate from pot p not already paired with this team
          // and ensure the candidate does not already have an opponent from the
          // current team's pot. This guarantees everyone max 1 opponent per pot.
          const candidates = originalPots[p].filter(candidateTeam => {
            if (candidateTeam === team) return false;
            if (fixtures.get(team).has(candidateTeam)) return false;
            // Prevent candidate already having an opponent from the pot of "team"
            const teamPotIndex = teamToPot.get(team);
            if (teamHasOpponentFromPot(candidateTeam, teamPotIndex)) return false;
            return true;
          });

          if (candidates.length === 0) continue;

          const opp = randomPick(candidates);
          addFixture(team, opp, p, teamToPot.get(opp));
          lines.push(`${team} - ${opp}`);
        }

        // Order opponents by their pot: Pot 1 -> Pot 6
        lines.sort((a, b) => {
          const oa = a.split(' - ')[1];
          const ob = b.split(' - ')[1];
          const pa = teamToPot.get(oa) ?? 0;
          const pb = teamToPot.get(ob) ?? 0;
          if (pa !== pb) return pa - pb;
          return oa.localeCompare(ob);
        });
        selectedTeamPill.textContent = team;

        // Prepare popup content (but show after slot reveal)
        const teamOverlayContent = document.getElementById('teamOverlayContent');
        const teamOverlayTitle = document.getElementById('teamOverlayTitle');
        const headerLogo = document.getElementById('popupHeaderLogo');
        const oppCount = document.getElementById('popupOppCount');
        teamOverlayTitle.textContent = team;
        headerLogo.src = `yeni-logolar/${team}.png`;
        headerLogo.alt = team;
        teamOverlayContent.innerHTML = '';
        lines.forEach(fixture => {
          const [teamName, opponentName] = fixture.split(' - ');

          const card = document.createElement('div');
          card.className = 'popup-card';

          const opponentBadge = document.createElement('div');
          opponentBadge.className = 'team-badge';
          const logoOp = document.createElement('img');
          logoOp.src = `yeni-logolar/${opponentName}.png`;
          logoOp.alt = opponentName;
          logoOp.className = 'team-logo';
          opponentBadge.appendChild(logoOp);

          const nameDiv = document.createElement('div');
          nameDiv.className = 'name';
          nameDiv.textContent = opponentName;

          const potPill = document.createElement('div');
          potPill.className = 'pill';
          potPill.textContent = `S…ôb…ôt ${teamToPot.get(opponentName) + 1}`;

          card.appendChild(opponentBadge);
          card.appendChild(nameDiv);
          card.appendChild(potPill);

          teamOverlayContent.appendChild(card);
        });
        oppCount.textContent = `${lines.length} r…ôqib`;

        renderGlobalFixtures();
        saveState();

        // Map opponents to their pot indices for slot reveal
        const finalOpponentsByPot = Array(6).fill('');
        lines.forEach(fixture => {
          const [, opponentName] = fixture.split(' - ');
          const pIdx = teamToPot.get(opponentName);
          if (typeof pIdx === 'number') finalOpponentsByPot[pIdx] = opponentName;
        });

        // Reveal slots sequentially, then confetti, hide overlay, and show popup
        if (typeof revealSlots === 'function') {
          revealSlots(finalOpponentsByPot).then(() => {
            confettiBurst(800);
            setTimeout(() => {
              drawOverlay.style.display = 'none';
              teamOverlay.style.display = 'flex';
              const popupCard = teamOverlay.querySelector('div');
              if (popupCard) {
                popupCard.classList.remove('popup-animate-in');
                // Force reflow for consecutive animations
                void popupCard.offsetWidth;
                popupCard.classList.add('popup-animate-in');
              }
            }, 650);
          });
        }

      }, 1200);
    }

    // Load persisted state if available, otherwise render fresh
    if (!loadState()) {
      renderPots();
    } else {
      renderPots();
      renderGlobalFixtures();
    }


  // 1. Add button dynamically (or you can place it in HTML directly)
  const finalBtn = document.createElement("button");
  finalBtn.textContent = "üèÜ N…ôtic…ôni g√∂st…ôr";
  finalBtn.className = "team-btn"; 
  document.body.appendChild(finalBtn); // put it at bottom, or append somewhere else
    
// 2. Add overlay container (hidden by default)
const overlay = document.createElement("div");
overlay.id = "finalOverlay";
overlay.style.cssText = `
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.95); color:white;
  display:none; justify-content:center; align-items:flex-start;
  z-index:1000; overflow:auto; padding:20px;
`;

overlay.innerHTML = `
  <div style="width:100%; margin:0 auto;">
    <button id="closeOverlay" style="
      float:right;
      padding:6px 12px;
      background:red;color:white;
      border:none;border-radius:4px;
      cursor:pointer
    ">X</button>
    <button id="exportExcel" style="
      float:right; margin-right:8px;
      padding:6px 12px;
      background:#198754;color:white;
      border:none;border-radius:4px;
      cursor:pointer
    ">Export Excel</button>
    <h1 style="text-align:center;margin:10px 0 16px;font-size:20px;">P√º≈ükatma n…ôtic…ôsi</h1>
    <div id="finalTabs" style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:8px 0 14px;"></div>
    <div id="finalDrawGrid" style="width:100%;"></div>
  </div>
`;

document.body.appendChild(overlay);



// Popup for a single selected team's opponents
const teamOverlay = document.createElement("div");
teamOverlay.id = "teamOverlay";
teamOverlay.style.cssText = `
  position:fixed; top:0; left:0; width:100%; height:100%;
  display:none; z-index:1100; background:rgba(0,0,0,0.7);
  align-items:center; justify-content:center;
`;

teamOverlay.innerHTML = `
  <div style="background:#ffffff; color:#222; border-radius:14px; padding:20px; width:min(1450px,95vw); max-height:95vh; overflow:auto;">
    <div class=\"popup-header\">
      <div class=\"team-badge\"><img id=\"popupHeaderLogo\" src=\"\" alt=\"\" style=\"width:100%;height:100%;object-fit:cover;\"/></div>
      <div class=\"team-name\" id=\"teamOverlayTitle\">Komanda</div>
      <div class=\"opponent-count\" id=\"popupOppCount\">0 opponents</div>
      <button id=\"closeTeamOverlay\" style=\"margin-left:12px;padding:6px 12px; background:#dc3545; color:#fff; border:none; border-radius:6px; cursor:pointer;\">Baƒüla</button>
    </div>
    <div id=\"teamOverlayContent\" class=\"popup-opponents\"></div>
  </div>
`;
document.body.appendChild(teamOverlay);

// Football draw overlay (pitch + ball) and confetti
const drawOverlay = document.createElement('div');
drawOverlay.className = 'draw-overlay';
drawOverlay.innerHTML = `
  <div class="draw-stage">
    <div class="stadium-light light-1"></div>
    <div class="stadium-light light-2"></div>
    <div class="stadium-light light-3"></div>
    <div class="stadium-light light-4"></div>
    <div class="pitch-lines"></div>
    <div class="half-line"></div>
    <div class="pen-area pen-left"></div>
    <div class="pen-area pen-right"></div>
    <div class="ball"></div>
    <div class="draw-sub" id="drawSubText">Komanda se√ßilir</div>
    <div class="draw-slots" id="drawSlots"></div>
    <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
    <div class="draw-title">ƒ∞xtiyari se√ßim edilir...</div>
  </div>
`;
document.body.appendChild(drawOverlay);

const confettiCanvas = document.getElementById('confettiCanvas');
const confettiCtx = confettiCanvas.getContext('2d');

function resizeConfettiCanvas() {
  confettiCanvas.width = drawOverlay.clientWidth;
  confettiCanvas.height = drawOverlay.clientHeight;
}
window.addEventListener('resize', resizeConfettiCanvas);
resizeConfettiCanvas();

function confettiBurst(durationMs = 700) {
  const colors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#a55eea', '#ff6b6b'];
  const particles = [];
  const rect = drawOverlay.getBoundingClientRect();
  const originX = rect.width / 2;
  const originY = rect.height * 0.25;
  const count = 120;
  for (let i = 0; i < count; i++) {
    const angle = Math.random() * Math.PI - Math.PI / 2;
    const speed = 4 + Math.random() * 6;
    particles.push({
      x: originX,
      y: originY,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed - 3,
      g: 0.12 + Math.random() * 0.12,
      w: 6 + Math.random() * 6,
      h: 8 + Math.random() * 12,
      r: Math.random() * Math.PI,
      vr: (-0.2 + Math.random() * 0.4),
      color: colors[Math.floor(Math.random() * colors.length)],
      alpha: 1,
    });
  }
  let rafId;
  const start = performance.now();
  function tick(now) {
    const elapsed = now - start;
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    particles.forEach(p => {
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.r += p.vr;
      p.alpha = Math.max(0, 1 - elapsed / (durationMs + 400));
      confettiCtx.save();
      confettiCtx.globalAlpha = p.alpha;
      confettiCtx.translate(p.x, p.y);
      confettiCtx.rotate(p.r);
      confettiCtx.fillStyle = p.color;
      confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      confettiCtx.restore();
    });
    if (elapsed < durationMs) {
      rafId = requestAnimationFrame(tick);
    }
  }
  rafId = requestAnimationFrame(tick);
  setTimeout(() => cancelAnimationFrame(rafId), durationMs + 50);
}

function showDrawOverlay(teamName) {
  const sub = document.getElementById('drawSubText');
  if (sub) sub.textContent = `${teamName}`;
  drawOverlay.style.display = 'flex';
  populateSlots(teamName);
  startSlotSpin(teamName);
}

function hideDrawOverlay() {
  // Fire confetti then hide shortly after
  confettiBurst(800);
  setTimeout(() => { drawOverlay.style.display = 'none'; }, 650);
}

// --- Live draw slots helpers ---
function populateSlots(selectedTeam) {
  const slots = document.getElementById('drawSlots');
  if (!slots) return;
  slots.innerHTML = '';
  for (let i = 0; i < 6; i++) {
    const slot = document.createElement('div');
    slot.className = 'slot';
    slot.dataset.pot = String(i);
    const img = document.createElement('img');
    img.alt = 'spinning';
    img.src = '';
    const label = document.createElement('div');
    label.className = 'label';
    label.textContent = `S…ôb…ôt ${i + 1}`;
    slot.appendChild(img);
    slot.appendChild(label);
    slots.appendChild(slot);
  }
}

let slotIntervals = [];
function startSlotSpin(selectedTeam) {
  stopSlotSpin();
  const slots = Array.from(document.querySelectorAll('.slot'));
  slots.forEach(slot => slot.classList.remove('revealed'));
  slots.forEach((slot) => {
    const potIdx = Number(slot.dataset.pot || 0);
    const img = slot.querySelector('img');
    const pool = (originalPots[potIdx] || []).filter(n => n !== selectedTeam);
    if (!pool.length) return;
    let k = 0;
    const id = setInterval(() => {
      k = (k + 1) % pool.length;
      const name = pool[k];
      if (img) {
        img.src = `yeni-logolar/${name}.png`;
        img.alt = name;
      }
    }, 90 + Math.random() * 80);
    slotIntervals.push(id);
  });
}

function stopSlotSpin() {
  if (!slotIntervals) return;
  slotIntervals.forEach(id => clearInterval(id));
  slotIntervals = [];
}

// Reveal each slot to the final opponent logo sequentially
function revealSlots(opponentsByPot) {
  return new Promise(resolve => {
    const slots = Array.from(document.querySelectorAll('.slot'));
    let idx = 0;
    function revealNext() {
      if (idx >= 6) {
        stopSlotSpin();
        resolve();
        return;
      }
      const slot = slots[idx];
      const finalName = opponentsByPot[idx] || '';
      const img = slot.querySelector('img');
      if (finalName && img) {
        img.src = `yeni-logolar/${finalName}.png`;
        img.alt = finalName;
      }
      slot.classList.add('revealed');
      idx++;
      setTimeout(revealNext, 220);
    }
    revealNext();
  });
}

function getSortedOpponentPots() {
  const opponentPots = new Set();
  fixtures.forEach(opps => opps.forEach(op => opponentPots.add(teamToPot.get(op))));
  return Array.from(opponentPots).sort((a,b)=>a-b);
}

function renderTabs(activePot = null) {
  const tabs = document.getElementById("finalTabs");
  if (!tabs) return;
  const sortedPots = getSortedOpponentPots();
  tabs.innerHTML = '';

  function makeBtn(label, potValue) {
    const btn = document.createElement('button');
    btn.textContent = label;
    btn.style.cssText = `
      padding:6px 10px;border-radius:999px;border:1px solid #2d2d2d;cursor:pointer;
      background:${(potValue===activePot || (potValue===null && activePot===null)) ? '#1e6f34' : '#0e0e0e'};
      color:${(potValue===activePot || (potValue===null && activePot===null)) ? '#fff' : '#9be07e'}; font-weight:700; font-size:12px;
    `;
    btn.addEventListener('click', () => {
      renderTabs(potValue);
      renderFinalDraw({ rowPot: potValue, colPot: null });
    });
    return btn;
  }

  tabs.appendChild(makeBtn('Hamƒ±sƒ±', null));
  sortedPots.forEach(p => tabs.appendChild(makeBtn(`S…ôb…ôt ${p+1}`, p)));
}

function renderFinalDraw(opts = {}) {
  const rowPot = (opts && typeof opts.rowPot === 'number') ? opts.rowPot : null;
  const colPot = (opts && typeof opts.colPot === 'number') ? opts.colPot : null;
  const grid = document.getElementById("finalDrawGrid");
  grid.innerHTML = "";

  // Opponent pots
  const sortedPotsAll = getSortedOpponentPots();
  const sortedPots = colPot === null ? sortedPotsAll : sortedPotsAll.filter(p => p === colPot);

  // Visual accents per pot
  const potColors = ['#27ae60','#16a085','#2980b9','#8e44ad','#e67e22','#c0392b'];

  // Stable home/away indicator for readability
  function getHomeAway(team, opponent) {
    const s = (team + '|' + opponent);
    let hash = 0;
    for (let i = 0; i < s.length; i++) hash = (hash * 31 + s.charCodeAt(i)) >>> 0;
    return (hash % 2 === 0) ? 'H' : 'A';
  }

  // Grid container
  const table = document.createElement("div");
  table.style.cssText = `
    display: grid;
    grid-template-columns: 180px repeat(${sortedPots.length}, 1fr);
    gap: 4px;
    width: 100%;
    min-width: 600px;
  `;

  // Header row
  const emptyHeader = document.createElement("div");
  emptyHeader.textContent = "Komanda / R…ôqib";
  emptyHeader.style.cssText = "background:#0e0e0e;color:#9be07e;font-weight:700;padding:8px;text-align:center;font-size:14px;border-top:3px solid #27ae60;cursor:pointer;";
  emptyHeader.addEventListener('click', () => { renderTabs(null); renderFinalDraw({ rowPot: null, colPot: null }); });
  table.appendChild(emptyHeader);

  sortedPots.forEach((potNum, idx) => {
    const th = document.createElement("div");
    th.textContent = `S…ôb…ôt ${potNum + 1}`;
    th.style.cssText = `background:#0e0e0e;color:#9be07e;font-weight:700;padding:8px;text-align:center;font-size:14px;border-top:3px solid ${potColors[idx % potColors.length]};cursor:pointer;`;
    th.addEventListener('click', () => { renderFinalDraw({ rowPot: potNum, colPot: null }); });
    table.appendChild(th);
  });

  // Group teams by pot
  const teamsByPot = {};
  Array.from(teamToPot.entries()).forEach(([team, pot]) => {
    if (!teamsByPot[pot]) teamsByPot[pot] = [];
    teamsByPot[pot].push(team);
  });
  const sortedTeamPots = Object.keys(teamsByPot).sort((a,b)=>a-b);

  // Body rows
  sortedTeamPots.forEach(potNum => {
    if (rowPot !== null && Number(potNum) !== rowPot) return;
    // Pot header row
    const potHeader = document.createElement("div");
    potHeader.textContent = `S…ôb…ôt ${Number(potNum)+1}`;
    potHeader.style.cssText = `
      background:#1e6f34;color:#ffffff;font-weight:700;
      padding:6px 8px;text-align:left; grid-column:1 / 2; font-size:12px;
    `;
    table.appendChild(potHeader);

    // Empty opponent cells for pot header
    sortedPots.forEach(() => {
      const emptyCell = document.createElement("div");
      emptyCell.style.cssText = "background:#111;";
      table.appendChild(emptyCell);
    });

    // Team rows
    teamsByPot[potNum].forEach(team => {
      // Team cell with logo
      const teamCell = document.createElement("div");
      teamCell.style.cssText = "background:#121212;color:#b6f0ff;font-weight:700;padding:8px;text-align:left;display:flex;align-items:center;gap:6px;font-size:12px;";

      const logo = document.createElement("img");
      logo.src = `yeni-logolar/${team}.png`;
      logo.alt = team;
      logo.style.cssText = "width:16px;height:16px;object-fit:contain;";
      logo.onerror = () => { logo.src = `yeni-logolar/${team}.jpeg`; };

      const nameSpan = document.createElement("span");
      nameSpan.textContent = team;
      nameSpan.style.fontSize = '12px';

      teamCell.appendChild(logo);
      teamCell.appendChild(nameSpan);
      table.appendChild(teamCell);

      // Opponent cells with logos
      sortedPots.forEach(opPot => {
        const cell = document.createElement("div");
        cell.style.cssText = "background:#151515;padding:8px;border:1px solid #242424;";

        const opponents = fixtures.get(team) || new Set();
        const opsInThisPot = Array.from(opponents).filter(op => teamToPot.get(op) === opPot);

        opsInThisPot.forEach(op => {
          const opContainer = document.createElement("div");
          opContainer.style.cssText = "display:flex;align-items:center;gap:4px;margin:2px 0;";

          const opLogo = document.createElement("img");
          opLogo.src = `yeni-logolar/${op}.png`;
          opLogo.alt = op;
          opLogo.style.cssText = "width:18px;height:18px;object-fit:contain;";
          opLogo.onerror = () => { opLogo.src = `yeni-logolar/${op}.jpeg`; };

          const opName = document.createElement("span");
          opName.textContent = op;
          opName.style.color = "#e8f7ff";
          opName.style.fontSize = '12px'

          // H/A indicator pill
          const ha = document.createElement('span');
          const side = getHomeAway(team, op);
          ha.textContent = side;
          ha.style.cssText = `
            display:inline-block; margin-left:6px; padding:1px 6px; border-radius:10px;
            font-size:10px; font-weight:700; letter-spacing:0.3px;
            background:${side==='H' ? '#1f8f34' : '#2c3e50'}; color:#ffffff;
          `;

          opContainer.appendChild(opLogo);
          opContainer.appendChild(opName);
          // opContainer.appendChild(ha);
          cell.appendChild(opContainer);
        });

        table.appendChild(cell);
      });
    });
  });

  grid.appendChild(table);
  grid.style.overflowX = "auto";
}

// 4. Event listeners
finalBtn.addEventListener("click", () => {
  renderTabs(null);
  renderFinalDraw({ rowPot: null, colPot: null });
  overlay.style.display = "flex";
});
document.getElementById("closeOverlay").addEventListener("click", () => {
  overlay.style.display = "none";
});

// Export final draw as CSV (Excel-compatible)
function exportFinalDrawToCSV() {
  const sortedPotsAll = getSortedOpponentPots();
  // Build header
  const headers = ["Komanda"].concat(sortedPotsAll.map(p => `Sebet ${p+1}`));

  // Sort teams by their pot then by name for stable output
  const teams = Array.from(teamToPot.keys()).sort((a, b) => {
    const pa = teamToPot.get(a) ?? 0;
    const pb = teamToPot.get(b) ?? 0;
    if (pa !== pb) return pa - pb;
    return a.localeCompare(b);
  });

  function csvEscape(value) {
    const s = String(value ?? "");
    if (/[",\n]/.test(s)) return '"' + s.replace(/"/g, '""') + '"';
    return s;
  }

  const rows = [headers.map(csvEscape).join(",")];

  teams.forEach(team => {
    const opps = fixtures.get(team) || new Set();
    const row = [csvEscape(team)];
    sortedPotsAll.forEach(p => {
      const opp = Array.from(opps).find(o => teamToPot.get(o) === p) || "";
      row.push(csvEscape(opp));
    });
    rows.push(row.join(","));
  });

  // Prepend UTF-8 BOM so Excel detects encoding properly
  const BOM = "\uFEFF";
  const csvContent = BOM + rows.join("\r\n");
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
  a.href = url;
  a.download = `puskatma-neticesi-${ts}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

document.getElementById("exportExcel").addEventListener("click", () => {
  exportFinalDrawToCSV();
});

// Reset button to clear persisted state
const resetBtn = document.createElement('button');
resetBtn.textContent = 'üîÑ Sƒ±fƒ±rla';
resetBtn.className = 'team-btn';
resetBtn.style.marginLeft = '10px';
document.body.appendChild(resetBtn);
resetBtn.addEventListener('click', () => {
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

document.getElementById("closeTeamOverlay").addEventListener("click", () => {
  teamOverlay.style.display = "none";
});


// Close popups with Escape key as well
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' || e.key === 'Esc') {
    // Close team details overlay if open
    if (teamOverlay && teamOverlay.style.display === 'flex') {
      teamOverlay.style.display = 'none';
    }
    // Close final results overlay if open
    if (overlay && overlay.style.display === 'flex') {
      overlay.style.display = 'none';
    }
  }
});


  </script>
</body>

</html>